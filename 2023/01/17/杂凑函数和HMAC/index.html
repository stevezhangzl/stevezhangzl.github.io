<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>杂凑函数和HMAC | SteveZhang博客</title><meta name="author" content="张龙"><meta name="copyright" content="张龙"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.杂凑函数概述1.什么是杂凑函数杂凑函数就是把任意长的输入消息串变化成固定长的输出串的一种函数。杂凑函数是信息安全中一个非常重要的工具，对一个任意长度的消息m施加运算，返回一个固定长度h(m)，杂凑函数h是公开的，不用对处理过程保密。杂凑值也被称为哈希（Hash）值、散列值、消息摘要等。 杂凑函数这个过程是单向的，逆向操作难以完成，而且碰撞（两个不同的输入产生相同的杂凑值）发生的概率非常小。杂凑"><meta property="og:type" content="article"><meta property="og:title" content="杂凑函数和HMAC"><meta property="og:url" content="https://stevezhangzl.github.io/2023/01/17/%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E5%92%8CHMAC/index.html"><meta property="og:site_name" content="SteveZhang博客"><meta property="og:description" content="1.杂凑函数概述1.什么是杂凑函数杂凑函数就是把任意长的输入消息串变化成固定长的输出串的一种函数。杂凑函数是信息安全中一个非常重要的工具，对一个任意长度的消息m施加运算，返回一个固定长度h(m)，杂凑函数h是公开的，不用对处理过程保密。杂凑值也被称为哈希（Hash）值、散列值、消息摘要等。 杂凑函数这个过程是单向的，逆向操作难以完成，而且碰撞（两个不同的输入产生相同的杂凑值）发生的概率非常小。杂凑"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><meta property="article:published_time" content="2023-01-17T00:42:28.000Z"><meta property="article:modified_time" content="2023-03-18T21:59:20.000Z"><meta property="article:author" content="张龙"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://stevezhangzl.github.io/2023/01/17/%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E5%92%8CHMAC/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"杂凑函数和HMAC",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-19 05:59:20"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0!==o){const a=new Date;o=864e5*o,t={value:t,expiry:a.getTime()+o};localStorage.setItem(e,JSON.stringify(t))}},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);const o=new Date;if(!(o.getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=a=>new Promise((t,e)=>{const o=document.createElement("script");o.src=a,o.async=!0,o.onerror=e,o.onload=o.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(o.onload=o.onreadystatechange=null,t())},document.head.appendChild(o)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="SteveZhang博客" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SteveZhang博客</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">杂凑函数和HMAC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-17T00:42:28.000Z" title="发表于 2023-01-17 08:42:28">2023-01-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-18T21:59:20.000Z" title="更新于 2023-03-19 05:59:20">2023-03-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="杂凑函数和HMAC"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-杂凑函数概述"><a href="#1-杂凑函数概述" class="headerlink" title="1.杂凑函数概述"></a>1.杂凑函数概述</h2><h3 id="1-什么是杂凑函数"><a href="#1-什么是杂凑函数" class="headerlink" title="1.什么是杂凑函数"></a>1.什么是杂凑函数</h3><p>杂凑函数就是把任意长的输入消息串变化成固定长的输出串的一种函数。杂凑函数是信息安全中一个非常重要的工具，对一个任意长度的消息m施加运算，返回一个固定长度h(m)，杂凑函数h是公开的，不用对处理过程保密。杂凑值也被称为哈希（Hash）值、散列值、消息摘要等。</p><p>杂凑函数这个过程是单向的，逆向操作难以完成，而且碰撞（两个不同的输入产生相同的杂凑值）发生的概率非常小。杂凑函数的消息输入中，单个比特串中大约一半的比特发生变化。</p><h3 id="2-杂凑函数的设计"><a href="#2-杂凑函数的设计" class="headerlink" title="2.杂凑函数的设计"></a>2.杂凑函数的设计</h3><p>主要<code>基于分组密码算法的杂凑函数</code>和<code>直接构造的杂凑函数</code>，并且都是迭代型的杂凑函数。其中，基于分组密码构造杂凑函数通过对分组密码输入输出模式进行组合构造杂凑函数。</p><h3 id="3-杂凑函数的分类"><a href="#3-杂凑函数的分类" class="headerlink" title="3.杂凑函数的分类"></a>3.杂凑函数的分类</h3><h4 id="1-不带密钥的杂凑函数"><a href="#1-不带密钥的杂凑函数" class="headerlink" title="1.不带密钥的杂凑函数"></a>1.不带密钥的杂凑函数</h4><p>不带密钥的杂凑函数在运算过种中没有<code>密钥</code>参与。不带密钥的杂凑函数的杂凑值只是消息输入的函数，无须密钥就可以计算。因此，这种类型的杂凑函数<code>不具有身份认证功能</code>，<code>仅提供数据完整性检验</code>，如篡改检测码（MDC）。按照所具有的性质，MDC又可分为弱单向杂凑函数和强单向杂凑函数，比如SM3就是不带密钥的杂凑函数。</p><h4 id="2-带密钥的杂凑函数"><a href="#2-带密钥的杂凑函数" class="headerlink" title="2.带密钥的杂凑函数"></a>2.带密钥的杂凑函数</h4><p>带密钥的杂凑函数在消息运算过程中有<code>密钥</code>参与。这类杂凑函数需要满足各种安全性要求，其杂凑值同时与密钥和消息输入相关，只有拥有密钥的人才能计算出相应的杂凑值。带密钥的杂凑函数不仅<code>能够检验数据的完整性</code>，还能<code>提供身份认证功能</code>，被称为<code>消息认证码</code>（MAC）。消息认证码的性质保证了只有拥有秘密密钥杂凑函数的人，才能产生正确的消息：MAC对。后面HMAC重点阐述。</p><h2 id="2-SM杂凑算法"><a href="#2-SM杂凑算法" class="headerlink" title="2.SM杂凑算法"></a>2.SM杂凑算法</h2><p><code>消息分组512bit，输出杂凑值256bit（32字节）</code></p><h3 id="1-Java和OpenSSL联合实现SM3算法"><a href="#1-Java和OpenSSL联合实现SM3算法" class="headerlink" title="1.Java和OpenSSL联合实现SM3算法"></a>1.Java和OpenSSL联合实现SM3算法</h3><p><code>sm3test.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sm3test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">byte</span>[] sm3(String data,<span class="keyword">int</span> len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;mysm3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String data = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] md = sm3(data,data.length());</span><br><span class="line"></span><br><span class="line">        String strHexbytes = DatatypeConverter.printHexBinary(md);</span><br><span class="line">        System.out.println(<span class="string">&quot;sm3结果：&quot;</span>);</span><br><span class="line">        System.out.println(strHexbytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>mysm3.cpp</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by zhanglong on 22-12-29.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sm3test.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;crypto/evp.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sm3_hash</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *message,<span class="keyword">size_t</span> len,<span class="keyword">unsigned</span> <span class="keyword">char</span> *hash,<span class="keyword">unsigned</span> <span class="keyword">int</span> *hash_len)</span></span>&#123;</span><br><span class="line">    EVP_MD_CTX *md_ctx;</span><br><span class="line">    <span class="keyword">const</span> EVP_MD *md;</span><br><span class="line"></span><br><span class="line">    md = <span class="built_in">EVP_sm3</span>();</span><br><span class="line">    md_ctx = <span class="built_in">EVP_MD_CTX_new</span>();</span><br><span class="line">    <span class="built_in">EVP_DigestInit_ex</span>(md_ctx,md, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">EVP_DigestUpdate</span>(md_ctx,message,len);</span><br><span class="line">    <span class="built_in">EVP_DigestFinal_ex</span>(md_ctx,hash,hash_len);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">EVP_MD_CTX_free</span>(md_ctx);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jbyteArray JNICALL <span class="title">Java_cn_com_jit_openssldemo_sm3test_sm3</span></span></span><br><span class="line"><span class="function">        <span class="params">(JNIEnv *env, jclass cls, jstring j_str, jint len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *c_str = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">512</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  	<span class="comment">//因为是摘要是32字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> md[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash_len,i;</span><br><span class="line"></span><br><span class="line">    jboolean isCopy;</span><br><span class="line">    c_str = env-&gt;<span class="built_in">GetStringUTFChars</span>(j_str,&amp;isCopy);<span class="comment">//生成native的char指针</span></span><br><span class="line">    <span class="keyword">if</span>(c_str == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;out of memory.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;From Java String:string:%s len:%ld isCopy:%d\n&quot;</span>,c_str, <span class="built_in">strlen</span>(c_str),isCopy);</span><br><span class="line">    <span class="built_in">sprintf</span>(buff,<span class="string">&quot;%s&quot;</span>,c_str);</span><br><span class="line"></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(j_str,c_str);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sm3_hash</span>((<span class="keyword">unsigned</span> <span class="keyword">char</span> *)buff,len,md,&amp;hash_len);</span><br><span class="line"></span><br><span class="line">    jbyteArray RtnArr = <span class="literal">nullptr</span>;</span><br><span class="line">    RtnArr = env-&gt;<span class="built_in">NewByteArray</span>(hash_len);</span><br><span class="line"></span><br><span class="line">    env-&gt;<span class="built_in">SetByteArrayRegion</span>(RtnArr, <span class="number">0</span>, hash_len, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> jbyte *&gt;(md));</span><br><span class="line">    <span class="keyword">return</span> RtnArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-HMAC"><a href="#3-HMAC" class="headerlink" title="3.HMAC"></a>3.HMAC</h2><h3 id="1-什么是HMAC"><a href="#1-什么是HMAC" class="headerlink" title="1.什么是HMAC"></a>1.什么是HMAC</h3><p>HMAC是密钥相关的哈希运算消息认证码的缩写，它是一种基于<code>Hash函数</code>和<code>密钥</code>进行<code>消息认证的方法</code>，在IPSec和其他网络协议（如SSL）现在已经成为事实上的Internet安全标准。它可以与<code>任何迭代型散列函数</code>捆绑使用。</p><p>HMAC是一种使用单向散列函数来构造消息认证码的方法，其中HMAC中的H就是Hash的意思。</p><p>HMAC中所使用的单向散列函数并不仅于一种，任何高强度的单向散列函数都可以被用于HMAC，将来设计出的新的单向散列函数也同样可以使用。使用SM3-HMAC、SHA-1、SHA-224、SHA-256、SHA-384、SHA-512所构造的HMAC分别称为HMAC-SM3、HMAC-SHA1、HMAC-SHA-224、HMAC-SHA-384、HMAC-SHA-512。</p><p>为了确保接收方所接收到的报文数据的完整性，人们采用消息认证来验证上述性质。目前，用于消息进行认证的主要方式有以下3种：消息认证码、散列函数和消息加密。</p><ul><li>消息认证码：一个需要密钥的算法，可以对可变长度的消息进行认证，把输出的结果作为认证符。</li><li>散列函数：将任意长度的消息映射成为定长的散列值的函数，以该散列值消息摘要作为认证符。</li><li>消息加密：将整个消息的密文作为认证符。</li></ul><p>人们越来越感兴趣于利用散列函数来设计MAC，原因有2个：</p><ol><li>一般的散列函数的软件执行速度比分组密码的要快。</li><li>密码散列函数的库代码来源广泛。</li></ol><p>HMAC应运而生。HMAC是一种利用密码学中的散列函数来进行消息认证的机制，它能提供的消息认证包括两方面内容：</p><ol><li><code>消息完整性认证</code>：能够证明消息内容在传送过程中没有被修改。</li><li><code>信源身份认证</code>：因为通信双方<code>共享</code>了认证的密钥，所以接收方能够认证发送该数据的信源与所宣称的一致，即能够可靠地确认接收消息与发送的一致。</li></ol><h3 id="2-HMAC在身份认证中的应用"><a href="#2-HMAC在身份认证中的应用" class="headerlink" title="2.HMAC在身份认证中的应用"></a>2.HMAC在身份认证中的应用</h3><p>HMAC主要应用在身份认证中，使用方法如下：</p><ol><li>客户端发出登录请求（假设是浏览器的GET请求）。</li><li>服务器返回一个<code>随机值</code>，并在会话中记录这个随机值。</li><li>客户端将该随机值作为密钥，对用户密码进行HMAC运算，然后提交给服务器。</li><li>服务器读取用户数据库中的用户密码和2 中发送的随机值，做与客户端一样的HMAC运算，然后与用户发送的结果比较，如果结果一致，就验证用户合法。</li></ol><p>HMAC算法的计算过程实际是对原文做了两次类似于加盐处理的哈希过程。在应用中，出于安全的考虑和数据的保密，需要使用加密算法，有时为了让加密结果更加扑朔迷离，常常会给被加密的数据加点“盐”。说白了，盐就是<code>一串数字</code>，完全是自己定义的。</p><h3 id="3-借助Java-Mac实现HMAC-MD5"><a href="#3-借助Java-Mac实现HMAC-MD5" class="headerlink" title="3.借助Java Mac实现HMAC-MD5"></a>3.借助Java Mac实现HMAC-MD5</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HMacMD5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_MAC = <span class="string">&quot;HmacMD5&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authKey 密钥(盐)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doHMAC</span><span class="params">(String source,String authKey)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Mac hmac_md5 = Mac.getInstance(KEY_MAC);</span><br><span class="line"></span><br><span class="line">        hmac_md5.init(<span class="keyword">new</span> SecretKeySpec(authKey.getBytes(),KEY_MAC));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] b = hmac_md5.doFinal(source.getBytes());</span><br><span class="line">        <span class="keyword">return</span> DatatypeConverter.printHexBinary(b).toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String authKey = <span class="string">&quot;64234c34ba34bfd3443df343ddf34423ddd&quot;</span>;</span><br><span class="line">        String source = <span class="string">&quot;UserIDKeyFromServer0000127.0.0.1&quot;</span>;</span><br><span class="line">        String key = doHMAC(source,authKey);</span><br><span class="line">        System.out.println(<span class="string">&quot;key=&quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-实现HMAC-SM3"><a href="#4-实现HMAC-SM3" class="headerlink" title="4.实现HMAC-SM3"></a>4.实现HMAC-SM3</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HMacSM3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 做sm3摘要  java版本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> offset</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> len</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] sm3(<span class="keyword">byte</span>[] msg,<span class="keyword">int</span> offset,<span class="keyword">int</span> len)&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] md = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">32</span>];</span><br><span class="line">        SM3Digest sm3 = <span class="keyword">new</span> SM3Digest();</span><br><span class="line">        sm3.update(msg,offset,len);</span><br><span class="line">        sm3.doFinal(md,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> md;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hmacsm3(<span class="keyword">byte</span>[] key,<span class="keyword">byte</span>[] text)&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] keypaded = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span>];</span><br><span class="line">        <span class="keyword">byte</span>[] hmac;</span><br><span class="line">        <span class="keyword">int</span> i,textlen = text.length;</span><br><span class="line">        <span class="keyword">int</span> keylen = key.length;</span><br><span class="line">        Arrays.fill(keypaded, (<span class="keyword">byte</span>) <span class="number">0</span>);<span class="comment">//初始化字节数组为0</span></span><br><span class="line">        <span class="keyword">if</span> (keylen &gt; <span class="number">64</span>)&#123;</span><br><span class="line">            keypaded = sm3(key,<span class="number">0</span>,keylen);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.arraycopy(key,<span class="number">0</span>,keypaded,<span class="number">0</span>,keylen);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] p = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> + textlen + <span class="number">32</span>];</span><br><span class="line">        <span class="comment">//前64字节填充</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">            p[i] = (<span class="keyword">byte</span>) ((<span class="keyword">byte</span>) keypaded[i] ^ (<span class="keyword">byte</span>) <span class="number">0x36</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//填充原数据text 到p的64字节后面</span></span><br><span class="line">        System.arraycopy(text,<span class="number">0</span>,p,<span class="number">64</span>,textlen);</span><br><span class="line">        <span class="comment">//对p做摘要得到hmac  出来摘要结果是32字节</span></span><br><span class="line">        hmac = sm3(p,<span class="number">0</span>,<span class="number">64</span> + textlen);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">            p[i] = (<span class="keyword">byte</span>) ((<span class="keyword">byte</span>) keypaded[i] ^ (<span class="keyword">byte</span>) <span class="number">0x5c</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把sm3摘要填充到p的64字节后面</span></span><br><span class="line">        System.arraycopy(hmac,<span class="number">0</span>,p,<span class="number">64</span>,<span class="number">32</span>);</span><br><span class="line">        <span class="comment">//再将对p做摘要</span></span><br><span class="line">        hmac = sm3(p,<span class="number">0</span>,<span class="number">64</span>+<span class="number">32</span>);</span><br><span class="line">        <span class="keyword">return</span> hmac;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String key = <span class="string">&quot;123&quot;</span>,data = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] res = hmacsm3(key.getBytes(),data.getBytes());</span><br><span class="line">        String strHex = DatatypeConverter.printHexBinary(res);</span><br><span class="line">        System.out.println(<span class="string">&quot;HMAC-SM3：&quot;</span> + strHex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-更通用的基于OpenSSL的哈希运算"><a href="#4-更通用的基于OpenSSL的哈希运算" class="headerlink" title="4.更通用的基于OpenSSL的哈希运算"></a>4.更通用的基于OpenSSL的哈希运算</h2><p>EVP系列函数主要封装了加密、摘要、编码三大类型的算法，使用算法前需要调用<code>OpenSSL_add_all_algorithms</code>函数。其中，以加密算法与摘要算法为基本，公开密钥算法是对数据加密采用了对称加密算法，对密钥采用非对称加密（公钥加密、私钥解密）。数字签名是非对称算法（私钥签名，公钥认证）。</p><p>常用的哈希函数包括</p><ul><li><code>EVP_MD_CTX_new</code>：其中EVP_MD_CTX_new用于创建摘要上下文结构体并进行初始化；</li><li><code>EVP_MD_CTX_destroy</code>：当摘要上下文结构体不再需要使用时，要进行销毁。</li><li><code>EVP_DigestInit_ex</code>：用于计算不定长消息摘要（也就是可以用来实现多包哈希运算）</li><li><code>EVP_DigestUpdate</code>：用于计算不定长消息摘要（也就是可以用来实现多包哈希运算）</li><li><code>EVP_DigestFinal_ex</code>：用于计算不定长消息摘要（也就是可以用来实现多包哈希运算）</li><li><code>EVP_Digest</code>：用于计算长度比较短的消息摘要（也就是用于单包哈希运算）</li></ul><h3 id="1-获取摘要算法函数EVP-get-digestbyname"><a href="#1-获取摘要算法函数EVP-get-digestbyname" class="headerlink" title="1.获取摘要算法函数EVP_get_digestbyname"></a>1.获取摘要算法函数<code>EVP_get_digestbyname</code></h3><p>根据字符串获取摘要算法<code>EVP_MD</code>，本函数查询摘要算法哈希表。其返回值可以传给其他hash函数使用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> EVP_MD *<span class="title">EVP_get_digestbyname</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>name：字符串，表示哈希名称，如”sha256”,”sha384”,”sha512”。</li><li>返回值：EVP_MD结构体指针，供后续使用，如果失败，返回NULL</li></ul><h3 id="2-创建结构体并初始化函数EVP-MD-CTX-new"><a href="#2-创建结构体并初始化函数EVP-MD-CTX-new" class="headerlink" title="2.创建结构体并初始化函数EVP_MD_CTX_new"></a>2.创建结构体并初始化函数<code>EVP_MD_CTX_new</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">EVP_MD_CTX *<span class="title">EVP_MD_CTX_new</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="3-销毁初始化函数EVP-MD-CTX-detroy"><a href="#3-销毁初始化函数EVP-MD-CTX-detroy" class="headerlink" title="3.销毁初始化函数EVP_MD_CTX_detroy"></a>3.销毁初始化函数<code>EVP_MD_CTX_detroy</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EVP_MD_CTX_destroy</span><span class="params">(EVP_MD_CTX *ctx)</span></span>;</span><br></pre></td></tr></table></figure><p>当不再需要使用摘要上下文结构体时，需要调用函数EVP_MD_CTX_destroy来销毁。</p><h3 id="4-摘要初始化函数EVP-DigestInit-ex"><a href="#4-摘要初始化函数EVP-DigestInit-ex" class="headerlink" title="4.摘要初始化函数EVP_DigestInit_ex"></a>4.摘要初始化函数<code>EVP_DigestInit_ex</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_DigestInit_ex</span><span class="params">(EVP_MD_CTX *ctx,<span class="keyword">const</span> EVP_MD *type,ENGINE *impl)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>ctx[in]：指向摘要上下文结构体，该结构体必须是已经初始化过的</li><li>impl：指向<code>ENGINE*</code>的指针，表示摘要算法所使用的引擎。应用程序可以使用自定义的算法引擎，如硬件摘要算法等；如果此参数为NULL，则使用默认引擎</li><li>返回值：成功返回1，失败返回0</li><li>type：表示所使用的摘要算法，算法用<code>EVP_MD</code>结构体表示，type指向这个结构体，该结构地址可以用下表中所示的函数返回来获得。也可以全名用<code>EVP_get_digestbyname</code>来获得</li></ul><table><thead><tr><th>摘要算法函数</th><th>说明</th></tr></thead><tbody><tr><td>const EVP_MD *EVP_md2(void);</td><td>返回MD2摘要算法</td></tr><tr><td>const EVP_MD *EVP_md4(void);</td><td>返回MD4摘要算法</td></tr><tr><td>const EVP_MD *EVP_sha1(void);</td><td>返回SHA1摘要算法</td></tr><tr><td>const EVP_MD *EVP_sha256(void);</td><td>返回SHA256摘要算法</td></tr><tr><td>const EVP_MD *EVP_sha384(void);</td><td>返回SHA384摘要算法</td></tr><tr><td>const EVP_MD *EVP_sha512(void);</td><td>返回SHA512摘要算法</td></tr></tbody></table><h3 id="5-摘要Upadte函数EVP-DigestUpdate"><a href="#5-摘要Upadte函数EVP-DigestUpdate" class="headerlink" title="5.摘要Upadte函数EVP_DigestUpdate"></a>5.摘要Upadte函数<code>EVP_DigestUpdate</code></h3><p>这是摘要算法第二步调用的函数，可以被多次调用，这样就可以处理大数据了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_DigestUpdate</span><span class="params">(EVP_MD_CTX *ctx,<span class="keyword">const</span> <span class="keyword">void</span> *d,<span class="keyword">size_t</span> cnt)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>ctx[in]</li><li>d[in]：指向要进行摘要计算的源数据的缓冲区</li><li>cnt[in]：表示要进行摘要计算的源数据的长度，单位是<code>字节</code></li><li>返回值：成功返回1，失败返回0</li></ul><h3 id="6-摘要结束函数EVP-Digest-Final-ex"><a href="#6-摘要结束函数EVP-Digest-Final-ex" class="headerlink" title="6.摘要结束函数EVP_Digest_Final_ex"></a>6.摘要结束函数<code>EVP_Digest_Final_ex</code></h3><p>这是摘要算法第三步要调用的函数，也是最后一步调用的函数。该函数只能调用一次，而且是最后调用。调用完，哈希结果就出来了。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> <span class="constructor">EVP_Digest_Final_ex(EVP_MD_CTX <span class="operator">*</span><span class="params">ctx</span>,<span class="params">unsigned</span> <span class="params">char</span> <span class="operator">*</span><span class="params">md</span>,<span class="params">unsigned</span> <span class="params">int</span> <span class="operator">*</span><span class="params">s</span>)</span>;</span><br></pre></td></tr></table></figure><ul><li>ctx[in]</li><li>md[out]：存放输出的哈希结果，对于不同的哈希算法，哈希结果长度不同，因此md所指向的缓冲区长度不要开辟小了</li><li>s[out]：指向整形变量的地址，该变量存和输出哈希结果的长度。</li><li>返回值：成功返回1，失败返回0</li></ul><h3 id="7-单包摘要计算函数EVP-Digest"><a href="#7-单包摘要计算函数EVP-Digest" class="headerlink" title="7.单包摘要计算函数EVP_Digest"></a>7.单包摘要计算函数<code>EVP_Digest</code></h3><p>该函数独立使用，输入要进行摘要计算的源数据，直接输出哈希结果。该函数适合于小长度的数据。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_Digest</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *data,<span class="keyword">size_t</span> count,<span class="keyword">unsigned</span> <span class="keyword">char</span> *md,<span class="keyword">unsigned</span> <span class="keyword">int</span> *size,<span class="keyword">const</span> EVP_MD *type,ENGINE *impl)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>data[in]：指向要进行摘要计算的源数据缓冲区</li><li>count[in]：表示要进行摘要计算的源数据的长度</li><li>md[in]：存放哈希结果的缓冲区</li><li>size[out]：存放输出哈希结果的长度</li><li>type：所使用的摘要算法EVP_MD</li><li>impl：使用引擎，默认为NULL</li><li>返回值：成功1，失败0</li></ul><h3 id="8-Java和OpenSSL的EVP多update实例"><a href="#8-Java和OpenSSL的EVP多update实例" class="headerlink" title="8.Java和OpenSSL的EVP多update实例"></a>8.Java和OpenSSL的EVP多update实例</h3><p><code>evptest.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.com.jit.openssldemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.bind.DatatypeConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">evptest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//小数据单包计算一次update</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">byte</span>[] doEvp(String data,<span class="keyword">int</span> len,String type);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//大数据多包计算多次update  c层的一次buff的字节数小于200 因为buff设置的就是200</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">byte</span>[] doEvpBig(String data,<span class="keyword">int</span> len,String type,<span class="keyword">int</span> count);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;myevp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String data = &quot;abcde&quot;;</span></span><br><span class="line">        String data = <span class="string">&quot;3dsferyewyrtetegvbzVEgarhaggavxcv&quot;</span>;</span><br><span class="line">        <span class="comment">//String data = &quot;abc&quot;;</span></span><br><span class="line">        <span class="keyword">byte</span>[] md = doEvp(data,data.length(),<span class="string">&quot;sha256&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String strHexBytes = DatatypeConverter.printHexBinary(md);</span><br><span class="line">        System.out.println(<span class="string">&quot;evp结果：&quot;</span>);</span><br><span class="line">        System.out.println(strHexBytes);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//这里传入type &#x27;sha256&#x27; &#x27;sha512&#x27; &#x27;md5&#x27;</span></span><br><span class="line">        <span class="keyword">byte</span>[] md2 = doEvpBig(data,data.length(),<span class="string">&quot;sha256&quot;</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        String strHexBytes2 = DatatypeConverter.printHexBinary(md2);</span><br><span class="line">        System.out.println(<span class="string">&quot;evp2结果：&quot;</span>);</span><br><span class="line">        System.out.println(strHexBytes2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应的c层的源码 <code>myevp.cpp</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by zhanglong on 22-12-29.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;evptest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;crypto/evp.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;math.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">evp_hash</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * type,<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *message,<span class="keyword">size_t</span> len,<span class="keyword">int</span> cn,<span class="keyword">unsigned</span> <span class="keyword">char</span> *md_value,<span class="keyword">unsigned</span> <span class="keyword">int</span> *hash_len)</span></span>&#123;</span><br><span class="line">    EVP_MD_CTX *mdctx = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">const</span> EVP_MD *md;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> md_len,i;</span><br><span class="line">    <span class="built_in">OpenSSL_add_all_algorithms</span>();<span class="comment">//加载所有函数，这个函数要第一个调用</span></span><br><span class="line">    md = <span class="built_in">EVP_get_digestbyname</span>(type);<span class="comment">//如果要改其他哈希算法，只需要替换字符串</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;OpenSSL_add_all_algorithms\n&quot;</span>);</span><br><span class="line">    <span class="comment">//开始哈希运算OpenSSL_add_all_algorithms</span></span><br><span class="line">    <span class="comment">//EVP_MD_CTX_init(&amp;mdctx);</span></span><br><span class="line">    mdctx = <span class="built_in">EVP_MD_CTX_new</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;EVP_MD_CTX_init&quot;</span>);</span><br><span class="line">    <span class="built_in">EVP_DigestInit_ex</span>(mdctx,md, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> buff[<span class="number">200</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;cn;i++)&#123;</span><br><span class="line">       <span class="keyword">double</span> sized = <span class="built_in"><span class="keyword">double</span></span>(len)/cn;</span><br><span class="line">       <span class="comment">//向上取整 比如 ceil(2.5) = 3</span></span><br><span class="line">       <span class="keyword">int</span> sziei = <span class="built_in">ceil</span>(sized);</span><br><span class="line">       <span class="comment">//内存拷贝</span></span><br><span class="line">       <span class="built_in">memcpy</span>(buff,message+i*sziei,sziei); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>,buff);</span><br><span class="line">       <span class="comment">//这里要用strlen而不是sizeof sizeof拿到的数组的大小，strlen遇到&#x27;\0&#x27;就停止了</span></span><br><span class="line">       <span class="built_in">EVP_DigestUpdate</span>(mdctx,buff,<span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)buff));<span class="comment">//update连续cn次</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//第3步 final</span></span><br><span class="line">    <span class="built_in">EVP_DigestFinal_ex</span>(mdctx,md_value,&amp;md_len);</span><br><span class="line">    *hash_len = md_len;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jbyteArray JNICALL <span class="title">Java_cn_com_jit_openssldemo_evptest_doEvp</span></span></span><br><span class="line"><span class="function">        <span class="params">(JNIEnv *env, jclass cls, jstring j_str, jint len, jstring j_type)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hell cpp\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *c_str = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">512</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> md[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash_len,i;</span><br><span class="line">    <span class="comment">//把jstirng转成char *</span></span><br><span class="line">    jboolean isCopy;</span><br><span class="line">    c_str = env-&gt;<span class="built_in">GetStringUTFChars</span>(j_str,&amp;isCopy);<span class="comment">//生成native的char指针</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c_str == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;out of memory.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把char * 转成char []</span></span><br><span class="line">    <span class="built_in">sprintf</span>(buff,<span class="string">&quot;%s&quot;</span>,c_str);</span><br><span class="line">    <span class="comment">//转换后，释放j_str,c_str</span></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(j_str,c_str);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * c_type = env-&gt;<span class="built_in">GetStringUTFChars</span>(j_type,&amp;isCopy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把md 32位的字节数组传进去，这里是地址，函数进行hash的填充</span></span><br><span class="line">    <span class="built_in">evp_hash</span>(c_type,<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *&gt;(buff), len,<span class="number">1</span>, md, &amp;hash_len);</span><br><span class="line"></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(j_type,c_type);</span><br><span class="line">    <span class="comment">//创建jbytearray 长度是hash_len 要返回给java层</span></span><br><span class="line">    jbyteArray RtnArr = <span class="literal">nullptr</span>;</span><br><span class="line">    RtnArr = env-&gt;<span class="built_in">NewByteArray</span>(hash_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把hash的char[] 转成java成的byte[]</span></span><br><span class="line">    env-&gt;<span class="built_in">SetByteArrayRegion</span>(RtnArr, <span class="number">0</span>, hash_len, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> jbyte *&gt;(md));</span><br><span class="line">    <span class="keyword">return</span> RtnArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jbyteArray JNICALL <span class="title">Java_cn_com_jit_openssldemo_evptest_doEvpBig</span></span></span><br><span class="line"><span class="function">  <span class="params">(JNIEnv *env, jclass cls, jstring j_str, jint len, jstring j_type, jint cn)</span></span>&#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *c_str = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">512</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> md[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash_len,i;</span><br><span class="line">    <span class="comment">//把jstirng转成char *</span></span><br><span class="line">    jboolean isCopy;</span><br><span class="line">    c_str = env-&gt;<span class="built_in">GetStringUTFChars</span>(j_str,&amp;isCopy);<span class="comment">//生成native的char指针</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c_str == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;out of memory.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把char * 转成char []</span></span><br><span class="line">    <span class="built_in">sprintf</span>(buff,<span class="string">&quot;%s&quot;</span>,c_str);</span><br><span class="line">    <span class="comment">//转换后，释放j_str,c_str</span></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(j_str,c_str);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * c_type = env-&gt;<span class="built_in">GetStringUTFChars</span>(j_type,&amp;isCopy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把md 32位的字节数组传进去，这里是地址，函数进行hash的填充</span></span><br><span class="line">    <span class="built_in">evp_hash</span>(c_type,<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *&gt;(buff), len,cn, md, &amp;hash_len);</span><br><span class="line"></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(j_type,c_type);</span><br><span class="line">    <span class="comment">//创建jbytearray 长度是hash_len 要返回给java层</span></span><br><span class="line">    jbyteArray RtnArr = <span class="literal">nullptr</span>;</span><br><span class="line">    RtnArr = env-&gt;<span class="built_in">NewByteArray</span>(hash_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把hash的char[] 转成java成的byte[]</span></span><br><span class="line">    env-&gt;<span class="built_in">SetByteArrayRegion</span>(RtnArr, <span class="number">0</span>, hash_len, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> jbyte *&gt;(md));</span><br><span class="line">    <span class="keyword">return</span> RtnArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://stevezhangzl.github.io">张龙</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://stevezhangzl.github.io/2023/01/17/%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E5%92%8CHMAC/">https://stevezhangzl.github.io/2023/01/17/%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E5%92%8CHMAC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://stevezhangzl.github.io" target="_blank">SteveZhang博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/20/C%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">C单例模式</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/15/c-cpp%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%E6%80%A7%E6%80%BB%E7%BB%93/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">c/cpp开发技巧性总结</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">张龙</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/stevezhangzl/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Do one thing at a time, and do well.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1.杂凑函数概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.什么是杂凑函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">2.杂凑函数的设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.3.</span> <span class="toc-text">3.杂凑函数的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%8D%E5%B8%A6%E5%AF%86%E9%92%A5%E7%9A%84%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.不带密钥的杂凑函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B8%A6%E5%AF%86%E9%92%A5%E7%9A%84%E6%9D%82%E5%87%91%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.带密钥的杂凑函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SM%E6%9D%82%E5%87%91%E7%AE%97%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">2.SM杂凑算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Java%E5%92%8COpenSSL%E8%81%94%E5%90%88%E5%AE%9E%E7%8E%B0SM3%E7%AE%97%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">1.Java和OpenSSL联合实现SM3算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HMAC"><span class="toc-number">3.</span> <span class="toc-text">3.HMAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFHMAC"><span class="toc-number">3.1.</span> <span class="toc-text">1.什么是HMAC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-HMAC%E5%9C%A8%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">2.HMAC在身份认证中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%80%9F%E5%8A%A9Java-Mac%E5%AE%9E%E7%8E%B0HMAC-MD5"><span class="toc-number">3.3.</span> <span class="toc-text">3.借助Java Mac实现HMAC-MD5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9E%E7%8E%B0HMAC-SM3"><span class="toc-number">3.4.</span> <span class="toc-text">4.实现HMAC-SM3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9B%B4%E9%80%9A%E7%94%A8%E7%9A%84%E5%9F%BA%E4%BA%8EOpenSSL%E7%9A%84%E5%93%88%E5%B8%8C%E8%BF%90%E7%AE%97"><span class="toc-number">4.</span> <span class="toc-text">4.更通用的基于OpenSSL的哈希运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95%E5%87%BD%E6%95%B0EVP-get-digestbyname"><span class="toc-number">4.1.</span> <span class="toc-text">1.获取摘要算法函数EVP_get_digestbyname</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0EVP-MD-CTX-new"><span class="toc-number">4.2.</span> <span class="toc-text">2.创建结构体并初始化函数EVP_MD_CTX_new</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%94%80%E6%AF%81%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0EVP-MD-CTX-detroy"><span class="toc-number">4.3.</span> <span class="toc-text">3.销毁初始化函数EVP_MD_CTX_detroy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%91%98%E8%A6%81%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0EVP-DigestInit-ex"><span class="toc-number">4.4.</span> <span class="toc-text">4.摘要初始化函数EVP_DigestInit_ex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%91%98%E8%A6%81Upadte%E5%87%BD%E6%95%B0EVP-DigestUpdate"><span class="toc-number">4.5.</span> <span class="toc-text">5.摘要Upadte函数EVP_DigestUpdate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%91%98%E8%A6%81%E7%BB%93%E6%9D%9F%E5%87%BD%E6%95%B0EVP-Digest-Final-ex"><span class="toc-number">4.6.</span> <span class="toc-text">6.摘要结束函数EVP_Digest_Final_ex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%8D%95%E5%8C%85%E6%91%98%E8%A6%81%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0EVP-Digest"><span class="toc-number">4.7.</span> <span class="toc-text">7.单包摘要计算函数EVP_Digest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Java%E5%92%8COpenSSL%E7%9A%84EVP%E5%A4%9Aupdate%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.8.</span> <span class="toc-text">8.Java和OpenSSL的EVP多update实例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/17/%E6%B0%94%E8%B1%A1%E6%95%B0%E6%8D%AE-%E7%AC%AC4%E7%AB%A0%E5%BC%80%E5%8F%91%E5%9F%BA%E4%BA%8Etcp%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%AD%90%E7%B3%BB%E7%BB%9F-2-%E5%B0%81%E8%A3%85socket%E5%87%BD%E6%95%B0/" title="气象数据-第4章开发基于tcp协议的文件传输子系统-2-封装socket函数"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="气象数据-第4章开发基于tcp协议的文件传输子系统-2-封装socket函数"></a><div class="content"><a class="title" href="/2023/03/17/%E6%B0%94%E8%B1%A1%E6%95%B0%E6%8D%AE-%E7%AC%AC4%E7%AB%A0%E5%BC%80%E5%8F%91%E5%9F%BA%E4%BA%8Etcp%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%AD%90%E7%B3%BB%E7%BB%9F-2-%E5%B0%81%E8%A3%85socket%E5%87%BD%E6%95%B0/" title="气象数据-第4章开发基于tcp协议的文件传输子系统-2-封装socket函数">气象数据-第4章开发基于tcp协议的文件传输子系统-2-封装socket函数</a><time datetime="2023-03-17T05:22:21.000Z" title="发表于 2023-03-17 13:22:21">2023-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/15/%E6%B0%94%E8%B1%A1%E6%95%B0%E6%8D%AE-%E7%AC%AC4%E7%AB%A0%E5%BC%80%E5%8F%91%E5%9F%BA%E4%BA%8Etcp%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%AD%90%E7%B3%BB%E7%BB%9F-1-%E8%A7%A3%E5%86%B3TCP%E7%B2%98%E5%8C%85%E5%92%8C%E5%88%86%E5%8C%85%E7%9A%84%E9%97%AE%E9%A2%98/" title="气象数据-第4章开发基于tcp协议的文件传输子系统-1-解决TCP粘包和分包的问题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="气象数据-第4章开发基于tcp协议的文件传输子系统-1-解决TCP粘包和分包的问题"></a><div class="content"><a class="title" href="/2023/03/15/%E6%B0%94%E8%B1%A1%E6%95%B0%E6%8D%AE-%E7%AC%AC4%E7%AB%A0%E5%BC%80%E5%8F%91%E5%9F%BA%E4%BA%8Etcp%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%AD%90%E7%B3%BB%E7%BB%9F-1-%E8%A7%A3%E5%86%B3TCP%E7%B2%98%E5%8C%85%E5%92%8C%E5%88%86%E5%8C%85%E7%9A%84%E9%97%AE%E9%A2%98/" title="气象数据-第4章开发基于tcp协议的文件传输子系统-1-解决TCP粘包和分包的问题">气象数据-第4章开发基于tcp协议的文件传输子系统-1-解决TCP粘包和分包的问题</a><time datetime="2023-03-15T05:17:57.000Z" title="发表于 2023-03-15 13:17:57">2023-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/25/%E8%AE%A4%E8%AF%86Android-mk/" title="认识Android.mk"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="认识Android.mk"></a><div class="content"><a class="title" href="/2023/02/25/%E8%AE%A4%E8%AF%86Android-mk/" title="认识Android.mk">认识Android.mk</a><time datetime="2023-02-25T01:02:03.000Z" title="发表于 2023-02-25 09:02:03">2023-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/23/tailscale-vpn%E8%BF%9E%E6%8E%A5%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86/" title="tailscale vpn连接逻辑梳理"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="tailscale vpn连接逻辑梳理"></a><div class="content"><a class="title" href="/2023/02/23/tailscale-vpn%E8%BF%9E%E6%8E%A5%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86/" title="tailscale vpn连接逻辑梳理">tailscale vpn连接逻辑梳理</a><time datetime="2023-02-23T05:28:53.000Z" title="发表于 2023-02-23 13:28:53">2023-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/19/golang-jni%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5/" title="Android Golang JNI调用学习实践"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Android Golang JNI调用学习实践"></a><div class="content"><a class="title" href="/2023/02/19/golang-jni%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5/" title="Android Golang JNI调用学习实践">Android Golang JNI调用学习实践</a><time datetime="2023-02-18T23:35:32.000Z" title="发表于 2023-02-19 07:35:32">2023-02-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 张龙</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>